<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BikeGuard - WiFi Setup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #ecfdf5 0%, #ffffff 100%);
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }
        @keyframes pulse-ring {
            0% {
                transform: scale(0.33);
            }
            80%, 100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }
        .connecting-animation {
            animation: connecting 2s ease-in-out infinite;
        }
        @keyframes connecting {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-emerald-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <i data-lucide="shield" class="h-8 w-8 text-emerald-600"></i>
                        <span class="ml-2 text-xl font-bold text-gray-900">BikeGuard</span>
                    </a>
                </div>

                <!-- Progress Indicator -->
                <div class="flex items-center space-x-2">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-emerald-600 rounded-full flex items-center justify-center">
                            <i data-lucide="check" class="h-4 w-4 text-white"></i>
                        </div>
                        <span class="ml-2 text-sm text-emerald-600 font-medium">Account</span>
                    </div>
                    <div class="w-8 h-0.5 bg-emerald-600"></div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-emerald-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">2</span>
                        </div>
                        <span class="ml-2 text-sm text-emerald-600 font-medium">WiFi Setup</span>
                    </div>
                    <div class="w-8 h-0.5 bg-gray-300"></div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                            <span class="text-gray-500 text-sm font-bold">3</span>
                        </div>
                        <span class="ml-2 text-sm text-gray-500">Complete</span>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="flex items-center">
                    <span id="user-name" class="text-gray-700 font-medium mr-4">User</span>
                    <button id="logout-btn" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="log-out" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl w-full space-y-8">
            <!-- Setup Container -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden slide-in">
                <!-- Header Section -->
                <div class="bg-gradient-to-r from-emerald-600 to-emerald-700 px-8 py-6">
                    <div class="text-center text-white">
                        <div class="relative inline-block mb-4">
                            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                                <i data-lucide="wifi" class="h-8 w-8"></i>
                            </div>
                            <div class="absolute inset-0 rounded-full border-2 border-white/30 pulse-ring"></div>
                        </div>
                        <h2 class="text-2xl font-bold mb-2">Connect Your BikeGuard Device</h2>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="p-8">

                    <!-- WiFi Setup Form -->
                    <form id="wifi-form" class="space-y-6">
                        <!-- Wifi Name Field -->
                        <div>
                            <label for="wifi-ssid" class="block text-sm font-medium text-gray-700 mb-2">Network Name (SSID)</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i data-lucide="wifi" class="h-5 w-5 text-gray-400"></i>
                                    </div>
                                    <input
                                        id="wifi-ssid"
                                        name="ssid"
                                        type="text"
                                        required
                                        class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200"
                                        placeholder="Enter WiFi network name"
                                    />
                                </div>
                        </div>

                        <!-- Password Field -->
                        <div>
                            <label for="wifi-password" class="block text-sm font-medium text-gray-700 mb-2">WiFi Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="lock" class="h-5 w-5 text-gray-400"></i>
                                </div>
                                <input
                                    id="wifi-password"
                                    name="password"
                                    type="password"
                                    required
                                    class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200"
                                    placeholder="Enter WiFi password"
                                />
                                <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <i data-lucide="eye" class="h-5 w-5 text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex space-x-4 pt-6">
                            <button
                                type="submit"
                                class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center"
                            >
                                <span id="connect-text">Connect Device</span>
                                <i id="connect-spinner" data-lucide="loader" class="h-5 w-5 ml-2 animate-spin hidden"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <!-- Connection Status Modal -->
    <div id="connection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 slide-in">
            <div class="text-center">
                <div id="modal-icon" class="bg-emerald-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="wifi" class="h-8 w-8 text-emerald-600 connecting-animation"></i>
                </div>
                <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-2">Connecting to WiFi...</h3>
                <p id="modal-message" class="text-gray-600 mb-6">Please wait while we configure your BikeGuard device.</p>
                <div id="modal-progress" class="w-full bg-gray-200 rounded-full h-2 mb-6">
                    <div class="bg-emerald-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <button id="modal-close" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 hidden">
                    Continue to Dashboard
                </button>
            </div>
        </div>
    </div>

    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        $(document).ready(function() {
            // Load user data
            var userData = JSON.parse(localStorage.getItem('bikeguard_user') || '{}');
            
            // Update user name
            if (userData.firstName) {
                $('#user-name').text(userData.firstName);
            } else if (userData.email) {
                $('#user-name').text(userData.email.split('@')[0]);
            }

            // Check if user is logged in
            if (!userData.email && !userData.firstName) {
                window.location.href = 'auth.html';
            }

            // Logout functionality
            // Check device config and redirect accordingly
            $('#logout-btn').on('click', function() {
                var userData = localStorage.getItem('bikeguard_user');
                if (userData) {
                    window.location.href = 'dashboard.html';
                } else {
                    localStorage.removeItem('bikeguard_user');
                    localStorage.removeItem('bikeguard_device');
                    window.location.href = 'auth.html';
                }
            });

            // Password visibility toggle
            $('#toggle-password').on('click', function() {
                var $passwordField = $('#wifi-password');
                var $icon = $('#toggle-password i');
                if ($passwordField.attr('type') === 'password') {
                    $passwordField.attr('type', 'text');
                    $icon.attr('data-lucide', 'eye-off');
                } else {
                    $passwordField.attr('type', 'password');
                    $icon.attr('data-lucide', 'eye');
                }
                lucide.createIcons();
            });

            // WiFi form submission
            $('#wifi-form').on('submit', function(e) {
                e.preventDefault();

                var formData = new FormData(this);
                var ssid = formData.get('ssid');
                var password = formData.get('password');

                if (!ssid) {
                    alert('Please enter the WiFi name');
                    return;
                }

                if (!password) {
                    alert('Please enter the WiFi password');
                    return;
                }

                // Show connecting modal
                showConnectionModal();

                // Simulate connection process
                simulateConnection(ssid, password, formData);
            });

            function showConnectionModal() {
                $('#connection-modal').removeClass('hidden');

                // Simulate connection progress
                var $progressBar = $('#modal-progress .bg-emerald-600');
                var progress = 0;

                var interval = setInterval(function() {
                    progress += Math.random() * 20;
                    if (progress > 100) progress = 100;

                    $progressBar.css('width', progress + '%');

                    if (progress >= 100) {
                        clearInterval(interval);
                    }
                }, 500);
            }

            function simulateConnection(ssid, password, formData) {
                var steps = [
                    { message: 'Connecting to BikeGuard device...', delay: 1000 },
                    { message: 'Sending WiFi credentials...', delay: 1500 },
                    { message: 'Testing connection...', delay: 2000 },
                    { message: 'Configuring device settings...', delay: 1000 },
                    { message: 'Connection successful!', delay: 500 }
                ];

                var currentStep = 0;

                function executeStep() {
                    if (currentStep < steps.length) {
                        $('#modal-message').text(steps[currentStep].message);

                        setTimeout(function() {
                            currentStep++;
                            executeStep();
                        }, steps[currentStep].delay);
                    } else {
                        // Connection complete
                        var $modalIcon = $('#modal-icon');
                        var $modalTitle = $('#modal-title');
                        var $modalMessage = $('#modal-message');
                        var $modalClose = $('#modal-close');

                        $modalIcon.html('<i data-lucide="check" class="h-8 w-8 text-emerald-600"></i>');
                        $modalIcon.attr('class', 'bg-emerald-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4');
                        $modalTitle.text('Device Connected!');
                        $modalMessage.text('Your BikeGuard device is now connected and ready to protect your motorcycle.');
                        $modalClose.removeClass('hidden');

                        lucide.createIcons();

                        // Store device configuration
                        var deviceConfig = {
                            ssid: ssid,
                            deviceName: formData.get('deviceName') || 'My BikeGuard',
                            updateInterval: formData.get('updateInterval') || '60',
                            status: 'connected',
                            setupDate: new Date().toISOString(),
                            lastSeen: new Date().toISOString()
                        };

                        localStorage.setItem('bikeguard_device', JSON.stringify(deviceConfig));
                    }
                }

                executeStep();
            }

            // Modal close button
            $('#modal-close').on('click', function() {
                window.location.href = 'dashboard.html';
            });

            // Simulate device detection after page load
            setTimeout(function() {
                var $deviceStatus = $('#device-status');
                $deviceStatus.html(`
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-emerald-500 rounded-full mr-3"></div>
                        <div>
                            <p class="text-emerald-800 font-medium">BikeGuard device found!</p>
                            <p class="text-emerald-600 text-sm">Device ID: BG-ESP32-A1B2C3 • Ready for setup</p>
                        </div>
                    </div>
                `);
                $deviceStatus.attr('class', 'mb-8 p-4 bg-emerald-50 border border-emerald-200 rounded-lg');
            }, 3000);
        });
    </script>
</body>
</html>