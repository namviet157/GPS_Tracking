<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BikeGuard - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #ecfdf5 0%, #ffffff 100%);
        }
        .gradient-dark {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        .tab-active {
            background-color: #059669;
            color: white;
        }
        .tab-inactive {
            color: #9ca3af;
        }
        .tab-inactive:hover {
            color: white;
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-emerald-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <i data-lucide="shield" class="h-8 w-8 text-emerald-600"></i>
                        <span class="ml-2 text-xl font-bold text-gray-900">BikeGuard</span>
                    </a>
                </div>

                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full mr-2"></div>
                        <span class="text-emerald-600 text-sm font-medium">Online</span>
                    </div>
                    
                    <div class="relative">
                        <button id="user-menu-btn" class="flex items-center space-x-2 text-gray-700 hover:text-emerald-600 transition-colors duration-200">
                            <div class="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center">
                                <i data-lucide="user" class="h-5 w-5 text-emerald-600"></i>
                            </div>
                            <span id="user-name" class="font-medium">User</span>
                            <i data-lucide="chevron-down" class="h-4 w-4"></i>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden">
                            <div class="py-1">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile Settings</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Billing</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Support</a>
                                <hr class="my-1">
                                <button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Sign Out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="mb-8 slide-in">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome back, <span id="welcome-name">User</span>!</h1>
            <p class="text-gray-600">Monitor and protect your motorcycle with real-time insights.</p>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 slide-in">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-emerald-100 rounded-lg p-3">
                        <i data-lucide="shield" class="h-6 w-6 text-emerald-600"></i>
                    </div>
                    <span class="text-emerald-600 font-semibold text-lg">Armed</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Security Status</h3>
                <p class="text-gray-600 text-sm">Your bike is protected</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 slide-in">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-blue-100 rounded-lg p-3">
                        <i data-lucide="battery" class="h-6 w-6 text-blue-600"></i>
                    </div>
                    <span class="text-blue-600 font-semibold text-lg">85%</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Battery Level</h3>
                <p class="text-gray-600 text-sm">12 days remaining</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 slide-in">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-purple-100 rounded-lg p-3">
                        <i data-lucide="map-pin" class="h-6 w-6 text-purple-600"></i>
                    </div>
                    <span id="distance-value" class="text-purple-600 font-semibold text-lg">--</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Distance</h3>
                <p class="text-gray-600 text-sm">From your location</p>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 slide-in">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-orange-100 rounded-lg p-3">
                        <i data-lucide="clock" class="h-6 w-6 text-orange-600"></i>
                    </div>
                    <span class="text-orange-600 font-semibold text-lg">2m</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Last Update</h3>
                <p class="text-gray-600 text-sm">Real-time monitoring</p>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Map Section -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden slide-in">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl font-semibold text-gray-900">Live Location</h2>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                                <span class="text-emerald-600 text-sm font-medium">Live</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="relative h-80 bg-gradient-to-br from-emerald-900/20 to-emerald-800/20 rounded-lg overflow-hidden">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <i data-lucide="map-pin" class="h-12 w-12 text-emerald-500 mx-auto mb-2"></i>
                                    <p class="text-emerald-600 font-medium">Your Bike Location</p>
                                    <p class="text-gray-600 text-sm">Downtown Area • Safe Zone</p>
                                </div>
                            </div>
                            <div class="absolute top-1/3 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                <div class="relative">
                                    <div class="w-4 h-4 bg-emerald-500 rounded-full animate-pulse"></div>
                                    <div class="absolute -inset-2 bg-emerald-500/30 rounded-full animate-ping"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex items-center justify-between">
                            <div class="text-sm text-gray-600">
                                <span class="font-medium">Last seen:</span> 2 minutes ago
                            </div>
                            <button class="text-emerald-600 hover:text-emerald-700 font-medium text-sm">
                                View Full Map
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Vibration History Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 slide-in">
                    <div class="p-6 border-b border-gray-200 flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-900">Lịch sử rung lắc xe máy</h2>
                        <span class="text-gray-400 text-sm">Biểu đồ thời gian thực</span>
                    </div>
                    <div class="p-6">
                        <canvas id="vibrationChart" height="80"></canvas>
                    </div>
                </div>
                
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 slide-in">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-900">Quick Actions</h2>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <button class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                            <i data-lucide="shield" class="h-5 w-5 mr-2"></i>
                            Arm Security
                        </button>
                        
                        <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                            <i data-lucide="map-pin" class="h-5 w-5 mr-2"></i>
                            Find My Bike
                        </button>
                        
                        <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                            <i data-lucide="settings" class="h-5 w-5 mr-2"></i>
                            Settings
                        </button>
                    </div>
                </div>

                <!-- Device Status -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 slide-in">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold text-gray-900">Device Status</h2>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i data-lucide="signal" class="h-5 w-5 text-emerald-500 mr-3"></i>
                                <span class="text-gray-700">Signal Strength</span>
                            </div>
                            <span class="text-emerald-600 font-semibold">Strong</span>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i data-lucide="wifi" class="h-5 w-5 text-emerald-500 mr-3"></i>
                                <span class="text-gray-700">Connection</span>
                            </div>
                            <span class="text-emerald-600 font-semibold">Connected</span>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i data-lucide="thermometer" class="h-5 w-5 text-blue-500 mr-3"></i>
                                <span class="text-gray-700">Temperature</span>
                            </div>
                            <span class="text-blue-600 font-semibold">22°C</span>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i data-lucide="zap" class="h-5 w-5 text-yellow-500 mr-3"></i>
                                <span class="text-gray-700">Power Mode</span>
                            </div>
                            <span class="text-yellow-600 font-semibold">Normal</span>
                        </div>
                    </div>
                </div>

                <!-- Support -->
                <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-6 slide-in">
                    <div class="text-center">
                        <div class="bg-emerald-600 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="headphones" class="h-6 w-6 text-white"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Need Help?</h3>
                        <p class="text-gray-600 text-sm mb-4">Our support team is available 24/7 to assist you.</p>
                        <button class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200">
                            Contact Support
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Load user data
        const userData = JSON.parse(localStorage.getItem('bikeguard_user') || '{}');
        
        // Update user name in header and welcome message
        if (userData.firstName) {
            document.getElementById('user-name').textContent = userData.firstName;
            document.getElementById('welcome-name').textContent = userData.firstName;
        } 
        else if (userData.email) {
            document.getElementById('user-name').textContent = userData.email.split('@')[0];
            document.getElementById('welcome-name').textContent = userData.email.split('@')[0];
        }

        // User menu toggle
        const userMenuBtn = document.getElementById('user-menu-btn');
        const userMenu = document.getElementById('user-menu');
        
        userMenuBtn.addEventListener('click', () => {
            userMenu.classList.toggle('hidden');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('bikeguard_user');
            window.location.href = 'auth.html';
        });

        // Check if user is logged in
        if (!userData.email && !userData.firstName) {
            window.location.href = 'auth.html';
        }

        // Giả lập vị trí xe máy (ví dụ: trung tâm thành phố Hà Nội)
        const lat_bike = 21.028511;
        const lon_bike = 105.804817;

        navigator.geolocation.getCurrentPosition(function(position) {
            const lat_user = position.coords.latitude;
            const lon_user = position.coords.longitude;

            // Tính khoảng cách
            const distance = haversine(lat_user, lon_user, lat_bike, lon_bike);

            // Hiển thị khoảng cách (làm tròn, đơn vị mét hoặc km)
            let display = '';
            if (distance >= 1000) {
                display = (distance / 1000).toFixed(2) + ' km';
            } else {
                display = Math.round(distance) + ' m';
            }
            document.getElementById('distance-value').textContent = display;
        }, function() {
            document.getElementById('distance-value').textContent = 'Không xác định';
        });

        function haversine(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Bán kính Trái Đất (m)
            const toRad = angle => angle * Math.PI / 180;
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat/2)**2 +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon/2)**2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // khoảng cách tính bằng mét
        }

        const ctx = document.getElementById('vibrationChart').getContext('2d');

        // Tạo dữ liệu mẫu cho 12 giờ gần nhất
        const hours = [];
        const now = new Date();
        for (let i = 11; i >= 0; i--) {
            const d = new Date(now.getTime() - i * 60 * 60 * 1000);
            hours.push(d.getHours() + ':00');
        }
        const vibrationData = Array.from({length: 12}, () => Math.floor(Math.random() * 10));

        // Khởi tạo biểu đồ đường
        const vibrationChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: hours,
                datasets: [{
                    label: 'Số lần rung lắc',
                    data: vibrationData,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16,185,129,0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointBackgroundColor: '#10b981',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 6,
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => ` ${ctx.parsed.y} lần`
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        title: { display: false }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f3f4f6' },
                        title: { display: false },
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });

        // Simulate real-time updates
        setInterval(() => {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            // Update last update time (this would be real data in production)
            const lastUpdateElements = document.querySelectorAll('[data-update-time]');
            lastUpdateElements.forEach(el => {
                el.textContent = 'Just now';
            });
        }, 30000); // Update every 30 seconds
    </script>
</body>
</html>